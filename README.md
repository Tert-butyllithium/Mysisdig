# My sysdig

> The *goal* of this project is to create another `sysdig` ~~(although impossible)~~

[Sysdig](https://github.com/draios/sysdig) is an awesome tool for capturing syscalls; however, it is too complex and not very suitable for `arm` devices (especially for developing board without package manager)

In our test (the same evluation environment as **Performance Evaluation**), the overall overhead could reach up to **15%**!!!

`My sysdig` aims to provide limited features to minimize dependencies and overhead

> WARNING: Mysysdig is a developing project and all functions have not been fully tested.

## User Manual 

Basically, you can `make` to compile the driver and then `insmod my_sysdig.ko` to install the kernel module. 

Then you could open file `/etc/syscall-record/record` to find all syscall logs. (You might need to create the directory and delete the file before run)

```bash
syscall 0x0, with pid=0xc36, name=dmesg
exit syscall, regs[0]=0xfffffffffffffffe, with pid=0xce1, ret=0xfffffffffffffffe, name=systemd-udevd
exit syscall, regs[0]=0x48, with pid=0x21e, ret=0x48, name=systemd-journal
syscall 0x101, with pid=0x21e, name=systemd-journal
syscall 0x101, with pid=0xce1, name=systemd-udevd
exit syscall, regs[0]=0x61, with pid=0xc36, ret=0x61, name=dmesg
exit syscall, regs[0]=0xfffffffffffffffe, with pid=0x21e, ret=0xfffffffffffffffe, name=systemd-journal
exit syscall, regs[0]=0x7, with pid=0xce1, ret=0x7, name=systemd-udevd
syscall 0x1, with pid=0xc36, name=dmesg
```

### Filter condition

- `pid`: `insmod my_sysdig.ko pid=1234`
- `proc_name`: `insmod my_sysdig.ko proc_name=test_syscall`

Note: because of the constraint of Linux, we will only compare the first 15 characters of `proc_name`

## Performance Evaluation

tl;dr: the overhead is extremely low (~1%)

### Test settings: 
- nginx web server (with a complex html page), 
- Ubuntu 18.04 (VM), Intel(R) Core(TM) i5-10500, 8G memory
- test by ` ab -n 50000 -c 1000 http://localhost/`

### Test result

(Need more turns of test)

26.138s (+0.5%), compared with 26.011s without our tracer 

### What's the cost?

A process could issue many times of syscalls with a second, so the trace file can be very large..

The size of the recod file generated by this test is (81M)


## TO-DO List

- [ ] record parameter changes for different types of syscall
- [ ] ~~capture interrupt...~~
- [x] using buffer instead of outputing to `dmesg`
- [ ] make more test